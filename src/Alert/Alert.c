/* Generated by wbuild from "Alert.w"
** (generator version $Revision$ of $Date$)
*/
#include <X11/IntrinsicP.h>
#include <X11/StringDefs.h>
#line 348 "Alert.w"
#include <stdlib.h>
#line 349 "Alert.w"
#include <stdio.h>
#line 350 "Alert.w"
#include <Xfwf/Icon.h>
#line 351 "Alert.w"
#include <Xfwf/Label.h>
#line 352 "Alert.w"
#include <Xfwf/RowCol.h>
#line 353 "Alert.w"
#include <Xfwf/Button.h>
#line 354 "Alert.w"
#include <Xfwf/Converters.h>
#include <Xfwf/AlertP.h>
static void _resolve_inheritance(
#if NeedFunctionPrototypes
WidgetClass
#endif
);
#line 290 "Alert.w"
static void class_initialize(
#if NeedFunctionPrototypes
void
#endif
);
#line 303 "Alert.w"
static void initialize(
#if NeedFunctionPrototypes
Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 319 "Alert.w"
static Boolean  set_values(
#if NeedFunctionPrototypes
Widget ,Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 339 "Alert.w"
static void destroy(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 156 "Alert.w"
#define ALLOC 1024 


#line 157 "Alert.w"
#define myrealloc(p, size) (void *)XtRealloc ((void *)p ,(size +ALLOC -1 )/ALLOC *ALLOC )


#line 159 "Alert.w"
#define mymalloc(size) (void *)XtMalloc (size )


#line 160 "Alert.w"
#define myfree(p) XtFree ((void *)p )


#line 167 "Alert.w"
static void button_pressed(
#if NeedFunctionPrototypes
Widget ,XtPointer ,XtPointer 
#endif
);
#line 176 "Alert.w"
static void click(
#if NeedFunctionPrototypes
Widget ,XtPointer ,XtPointer 
#endif
);
#line 188 "Alert.w"
static void create_children(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 167 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 167 "Alert.w"
static void button_pressed(Widget  w,XtPointer  client_data,XtPointer  call_data)
#else
#line 167 "Alert.w"
static void button_pressed(w,client_data,call_data)Widget  w;XtPointer  client_data;XtPointer  call_data;
#endif
#line 168 "Alert.w"
{
    XtPopdown(w);
    *((int*) client_data) = (int) call_data;
}
#line 176 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 176 "Alert.w"
static void click(Widget  w,XtPointer  client_data,XtPointer  call_data)
#else
#line 176 "Alert.w"
static void click(w,client_data,call_data)Widget  w;XtPointer  client_data;XtPointer  call_data;
#endif
#line 177 "Alert.w"
{
    Widget self = XtParent(XtParent(w));

    ((XfwfAlertWidget)self)->xfwfAlert.lastChoice = (int) client_data;
    XtCallCallbackList(self, ((XfwfAlertWidget)self)->xfwfAlert.callback, (XtPointer) ((XfwfAlertWidget)self)->xfwfAlert.lastChoice);
}
#line 188 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 188 "Alert.w"
static void create_children(Widget self)
#else
#line 188 "Alert.w"
static void create_children(self)Widget self;
#endif
#line 189 "Alert.w"
{
    Dimension ht, maxht, iconwd, iconht, labelwd, wd, bframe, labelht;
    Widget toprow, bottomrow, iconw, labelw, btn;
    Position x, buttony;
    String buttons, p;
    char name[20];
    int i;

    /*
     * Destroy old copies of the children
     */
    if (((XfwfAlertWidget)self)->xfwfAlert.iconw) XtDestroyWidget(((XfwfAlertWidget)self)->xfwfAlert.iconw);
    if (((XfwfAlertWidget)self)->xfwfAlert.labelw) XtDestroyWidget(((XfwfAlertWidget)self)->xfwfAlert.labelw);
    for (i = 0; i < ((XfwfAlertWidget)self)->xfwfAlert.num_buttons; i++) XtDestroyWidget(((XfwfAlertWidget)self)->xfwfAlert.buttonw[i]);

    bframe = XfwfCallFrameWidth(((XfwfAlertWidget)self)->xfwfAlert.outer);	/* Board's frame */
    if (((XfwfAlertWidget)self)->xfwfAlert.buttons) buttons = XtNewString(((XfwfAlertWidget)self)->xfwfAlert.buttons); /* Temporary copy */

    iconw = XtVaCreateManagedWidget
	("icon", xfwfIconWidgetClass, ((XfwfAlertWidget)self)->xfwfAlert.outer,
	 XtNx, bframe,
	 XtNy, bframe,
	 XtNimage, ((XfwfAlertWidget)self)->xfwfAlert.icon,
	 XtNtraversalOn, False,
	 NULL);
    iconwd = ((XfwfAlertWidget)iconw)->core.width;
    iconht = ((XfwfAlertWidget)iconw)->core.height;

    labelw = XtVaCreateManagedWidget
	("label", xfwfLabelWidgetClass, ((XfwfAlertWidget)self)->xfwfAlert.outer,
	 XtNx, bframe + iconwd,
	 XtNy, bframe,
	 XtNshrinkToFit, True,
	 XtNlabel, ((XfwfAlertWidget)self)->xfwfAlert.message,
	 NULL);
    labelwd = ((XfwfAlertWidget)labelw)->core.width;
    labelht = ((XfwfAlertWidget)labelw)->core.height;

    buttony = bframe + max(iconht, labelht);
    x = bframe + iconwd;
    maxht = 0;
    ((XfwfAlertWidget)self)->xfwfAlert.num_buttons = 0;
    if (((XfwfAlertWidget)self)->xfwfAlert.buttons) {
	i = 0;
	p = strtok(buttons, "|");
	while (p) {
	    ((XfwfAlertWidget)self)->xfwfAlert.buttonw = myrealloc(((XfwfAlertWidget)self)->xfwfAlert.buttonw, (i + 1) * sizeof(*((XfwfAlertWidget)self)->xfwfAlert.buttonw));
	    sprintf(name, "%d", i);
	    btn = XtVaCreateManagedWidget
		(name, xfwfButtonWidgetClass, ((XfwfAlertWidget)self)->xfwfAlert.outer,
		 XtNx, x,
		 XtNy, buttony,
		 XtNshrinkToFit, True,
		 XtNlabel, p,
		 NULL);
	    wd = ((XfwfAlertWidget)btn)->core.width;
	    ht = ((XfwfAlertWidget)btn)->core.height;
	    XtAddCallback(btn, XtNactivate, click, (XtPointer) i);
	    maxht = max(maxht, ht);
	    x += wd;
	    ((XfwfAlertWidget)self)->xfwfAlert.buttonw[i] = btn;
	    i++;
	    p = strtok(NULL, "|");
	    ((XfwfAlertWidget)self)->xfwfAlert.num_buttons++;
	}
	((XfwfAlertWidget)self)->xfwfAlert.num_buttons = i;
    } else {
	((XfwfAlertWidget)self)->xfwfAlert.buttonw = mymalloc(2 * sizeof(*((XfwfAlertWidget)self)->xfwfAlert.buttonw));
	((XfwfAlertWidget)self)->xfwfAlert.num_buttons = 1;
	btn = XtVaCreateManagedWidget
	    ("0", xfwfButtonWidgetClass, ((XfwfAlertWidget)self)->xfwfAlert.outer,
	     XtNx, x,
	     XtNy, buttony,
	     XtNshrinkToFit, True,
	     XtNlabel, " OK ",
	     NULL);
	wd = ((XfwfAlertWidget)btn)->core.width;
	ht = ((XfwfAlertWidget)btn)->core.height;
	XtAddCallback(btn, XtNactivate, click, 0);
	maxht = ht;
	x += wd;
	((XfwfAlertWidget)self)->xfwfAlert.buttonw[0] = btn;
    }
    if (((XfwfAlertWidget)self)->xfwfAlert.buttons) XtFree(buttons);

    /*
     * And finally resize the outer Board
     */
    XtResizeWidget(((XfwfAlertWidget)self)->xfwfAlert.outer, max(x + bframe, iconwd + labelwd + 2 * bframe),
		   buttony + maxht + bframe, 0);

    ((XfwfAlertWidget)self)->xfwfAlert.iconw = iconw;
    ((XfwfAlertWidget)self)->xfwfAlert.labelw = labelw;
}

static XtResource resources[] = {
#line 35 "Alert.w"
{XtNicon,XtCIcon,XtRIcon,sizeof(((XfwfAlertRec*)NULL)->xfwfAlert.icon),XtOffsetOf(XfwfAlertRec,xfwfAlert.icon),XtRString,(XtPointer)"NONE"},
#line 39 "Alert.w"
{XtNmessage,XtCMessage,XtRString,sizeof(((XfwfAlertRec*)NULL)->xfwfAlert.message),XtOffsetOf(XfwfAlertRec,xfwfAlert.message),XtRImmediate,(XtPointer)NULL },
#line 46 "Alert.w"
{XtNbuttons,XtCButtons,XtRString,sizeof(((XfwfAlertRec*)NULL)->xfwfAlert.buttons),XtOffsetOf(XfwfAlertRec,xfwfAlert.buttons),XtRImmediate,(XtPointer)NULL },
#line 53 "Alert.w"
{XtNlastChoice,XtCLastChoice,XtRInt,sizeof(((XfwfAlertRec*)NULL)->xfwfAlert.lastChoice),XtOffsetOf(XfwfAlertRec,xfwfAlert.lastChoice),XtRImmediate,(XtPointer)0 },
#line 60 "Alert.w"
{XtNcallback,XtCCallback,XtRCallback,sizeof(((XfwfAlertRec*)NULL)->xfwfAlert.callback),XtOffsetOf(XfwfAlertRec,xfwfAlert.callback),XtRImmediate,(XtPointer)NULL },
};

XfwfAlertClassRec xfwfAlertClassRec = {
{ /* core_class part */
/* superclass   	*/  (WidgetClass) &transientShellClassRec,
/* class_name   	*/  "XfwfAlert",
/* widget_size  	*/  sizeof(XfwfAlertRec),
/* class_initialize 	*/  class_initialize,
/* class_part_initialize*/  _resolve_inheritance,
/* class_inited 	*/  FALSE,
/* initialize   	*/  initialize,
/* initialize_hook 	*/  NULL,
/* realize      	*/  XtInheritRealize,
/* actions      	*/  NULL,
/* num_actions  	*/  0,
/* resources    	*/  resources,
/* num_resources 	*/  5,
/* xrm_class    	*/  NULLQUARK,
/* compres_motion 	*/  False ,
/* compress_exposure 	*/  FALSE ,
/* compress_enterleave 	*/  False ,
/* visible_interest 	*/  False ,
/* destroy      	*/  destroy,
/* resize       	*/  XtInheritResize,
/* expose       	*/  XtInheritExpose,
/* set_values   	*/  set_values,
/* set_values_hook 	*/  NULL,
/* set_values_almost 	*/  XtInheritSetValuesAlmost,
/* get_values+hook 	*/  NULL,
/* accept_focus 	*/  XtInheritAcceptFocus,
/* version      	*/  XtVersion,
/* callback_private 	*/  NULL,
/* tm_table      	*/  NULL,
/* query_geometry 	*/  XtInheritQueryGeometry,
/* display_acceleator 	*/  XtInheritDisplayAccelerator,
/* extension    	*/  NULL 
},
{ /* composite_class part */
XtInheritGeometryManager,
XtInheritChangeManaged,
XtInheritInsertChild,
XtInheritDeleteChild,
NULL
},
{ /* Shell_class part */
 /* dummy */  0
},
{ /* WMShell_class part */
 /* dummy */  0
},
{ /* VendorShell_class part */
 /* dummy */  0
},
{ /* TransientShell_class part */
 /* dummy */  0
},
{ /* XfwfAlert_class part */
 /* dummy */  0
},
};
WidgetClass xfwfAlertWidgetClass = (WidgetClass) &xfwfAlertClassRec;
static void _resolve_inheritance(class)
WidgetClass class;
{
  XfwfAlertWidgetClass c = (XfwfAlertWidgetClass) class;
  XfwfAlertWidgetClass super;
  static CompositeClassExtensionRec extension_rec = {
    NULL, NULLQUARK, XtCompositeExtensionVersion,
    sizeof(CompositeClassExtensionRec), True};
  CompositeClassExtensionRec *ext;
  ext = (XtPointer)XtMalloc(sizeof(*ext));
  *ext = extension_rec;
  ext->next_extension = c->composite_class.extension;
  c->composite_class.extension = ext;
  if (class == xfwfAlertWidgetClass) return;
  super = (XfwfAlertWidgetClass)class->core_class.superclass;
}
#line 290 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 290 "Alert.w"
static void class_initialize(void)
#else
#line 290 "Alert.w"
static void class_initialize()
#endif
#line 291 "Alert.w"
{
    static XtConvertArgRec args[] = {
    { XtWidgetBaseOffset, 0, sizeof(Widget) } };

    XtSetTypeConverter(XtRString, "Icon", cvtStringToIcon,
		       args, XtNumber(args), XtCacheNone, NULL);
}
#line 303 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 303 "Alert.w"
static void initialize(Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 303 "Alert.w"
static void initialize(request,self,args,num_args)Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 304 "Alert.w"
{
    ((XfwfAlertWidget)self)->xfwfAlert.outer = NULL;
    ((XfwfAlertWidget)self)->xfwfAlert.buttonw = NULL;
    ((XfwfAlertWidget)self)->xfwfAlert.labelw = NULL;
    ((XfwfAlertWidget)self)->xfwfAlert.iconw = NULL;
    ((XfwfAlertWidget)self)->xfwfAlert.num_buttons = NULL;
    ((XfwfAlertWidget)self)->xfwfAlert.buttons = XtNewString(((XfwfAlertWidget)self)->xfwfAlert.buttons);
    ((XfwfAlertWidget)self)->xfwfAlert.message = XtNewString(((XfwfAlertWidget)self)->xfwfAlert.message);
    ((XfwfAlertWidget)self)->xfwfAlert.outer = XtVaCreateManagedWidget("outer", xfwfBoardWidgetClass, self, NULL);
    create_children(self);
}
#line 319 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 319 "Alert.w"
static Boolean  set_values(Widget  old,Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 319 "Alert.w"
static Boolean  set_values(old,request,self,args,num_args)Widget  old;Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 320 "Alert.w"
{
    Boolean recreate = False;

    if (((XfwfAlertWidget)old)->xfwfAlert.message != ((XfwfAlertWidget)self)->xfwfAlert.message) {
	XtFree(((XfwfAlertWidget)old)->xfwfAlert.message);
	((XfwfAlertWidget)self)->xfwfAlert.message = XtNewString(((XfwfAlertWidget)self)->xfwfAlert.message);
	recreate = True;
    }
    if (((XfwfAlertWidget)old)->xfwfAlert.buttons != ((XfwfAlertWidget)self)->xfwfAlert.buttons) {
	XtFree(((XfwfAlertWidget)old)->xfwfAlert.buttons);
	((XfwfAlertWidget)self)->xfwfAlert.buttons = XtNewString(((XfwfAlertWidget)self)->xfwfAlert.buttons);
	recreate = True;
    }
    if (((XfwfAlertWidget)old)->xfwfAlert.icon != ((XfwfAlertWidget)self)->xfwfAlert.icon || recreate) {
	create_children(self);
    }
    return False;
}
#line 339 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 339 "Alert.w"
static void destroy(Widget self)
#else
#line 339 "Alert.w"
static void destroy(self)Widget self;
#endif
#line 340 "Alert.w"
{
    XtFree(((XfwfAlertWidget)self)->xfwfAlert.buttons);
    XtFree(((XfwfAlertWidget)self)->xfwfAlert.message);
    XtFree((String) ((XfwfAlertWidget)self)->xfwfAlert.buttonw);
}
#line 118 "Alert.w"
#line 119 "Alert.w"
#line 121 "Alert.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 121 "Alert.w"
int  XfwfDialog(String  name,Widget  parent,String  icon,String  msg,String  buttons)
#else
#line 121 "Alert.w"
int  XfwfDialog(name,parent,icon,msg,buttons)String  name;Widget  parent;String  icon;String  msg;String  buttons;
#endif
#line 122 "Alert.w"
{
    Widget alert;
    int choice = -1;
    XEvent event;
    Position x, y;
    Dimension wd, ht, wd1, ht1;

    x = ((XfwfAlertWidget)parent)->core.x;
    y = ((XfwfAlertWidget)parent)->core.y;
    wd = ((XfwfAlertWidget)parent)->core.width;
    ht = ((XfwfAlertWidget)parent)->core.height;
    alert = XtVaCreatePopupShell
	(name, xfwfAlertWidgetClass, parent,
	 XtVaTypedArg, XtNicon, XtRString, icon, strlen(icon) + 1,
	 XtNmessage, msg,
	 XtNbuttons, buttons,
	 NULL);
    XtAddCallback(alert, XtNcallback, button_pressed, &choice);
    XtRealizeWidget(alert);
    wd1 = ((XfwfAlertWidget)alert)->core.width;
    ht1 = ((XfwfAlertWidget)alert)->core.height;
    x = max(0, x + wd/2 - wd1/2);
    y = max(0, y + ht/2 - ht1/2);
    XtMoveWidget(alert, x, y);
    XtPopup(alert, XtGrabExclusive);
    while (choice == -1)
	XtAppProcessEvent(XtWidgetToApplicationContext(parent),
			  XtIMXEvent | XtIMTimer);
    XtDestroyWidget(alert);
    return choice;
}

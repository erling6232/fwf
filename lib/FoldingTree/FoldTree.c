/* Generated by wbuild from "FoldTree.w"
** (generator version $Revision$ of $Date$)
*/
#if HAVE_CONFIG_H
#  include <config.h>
#endif

#include <X11/IntrinsicP.h>
#include <X11/StringDefs.h>
#line 471 "FoldTree.w"
#include "plus.xpm"
#line 472 "FoldTree.w"
#include "minus.xpm"
#line 473 "FoldTree.w"
#include "dot.xpm"
#line 474 "FoldTree.w"
#include <Xfwf/Board.h>
#line 475 "FoldTree.w"
#include <Xfwf/Icon.h>
#line 476 "FoldTree.w"
#include <X11/Xmu/Converters.h>
#line 477 "FoldTree.w"
#include <Xfwf/Converters.h>
#include <Xfwf/FoldTreeP.h>
#line 349 "FoldTree.w"
static void expand(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 354 "FoldTree.w"
static void collapse(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);
#line 359 "FoldTree.w"
static void toggle(
#if NeedFunctionPrototypes
Widget,XEvent*,String*,Cardinal*
#endif
);

static XtActionsRec actionsList[] = {
{"expand", expand},
{"collapse", collapse},
{"toggle", toggle},
};

static char defaultTranslations[] = "\
<Key>plus: expand() \n\
<Key>minus: collapse() \n\
";
static void _resolve_inheritance(
#if NeedFunctionPrototypes
WidgetClass
#endif
);
#line 69 "FoldTree.w"
static void class_initialize(
#if NeedFunctionPrototypes
void
#endif
);
#line 83 "FoldTree.w"
static void initialize(
#if NeedFunctionPrototypes
Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 120 "FoldTree.w"
static void destroy(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 130 "FoldTree.w"
static void insert_child(
#if NeedFunctionPrototypes
Widget 
#endif
);
#line 142 "FoldTree.w"
static void change_managed(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 149 "FoldTree.w"
static void resize(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 157 "FoldTree.w"
static Boolean  set_values(
#if NeedFunctionPrototypes
Widget ,Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 194 "FoldTree.w"
static XtGeometryResult  geometry_manager(
#if NeedFunctionPrototypes
Widget ,XtWidgetGeometry *,XtWidgetGeometry *
#endif
);
#line 219 "FoldTree.w"
static void layout(
#if NeedFunctionPrototypes
Widget,int 
#endif
);
#line 334 "FoldTree.w"
static void expose(
#if NeedFunctionPrototypes
Widget,XEvent *,Region 
#endif
);
#line 368 "FoldTree.w"
static Boolean  icons_created = False ;
#line 369 "FoldTree.w"
static Icon  iconPlus;
#line 370 "FoldTree.w"
static Icon  iconMinus;
#line 371 "FoldTree.w"
static Icon  iconDot;
#line 375 "FoldTree.w"
static void expand_CB(
#if NeedFunctionPrototypes
Widget ,XtPointer ,XtPointer 
#endif
);
#line 384 "FoldTree.w"
static void collapse_CB(
#if NeedFunctionPrototypes
Widget ,XtPointer ,XtPointer 
#endif
);
#line 393 "FoldTree.w"
static void toggle_CB(
#if NeedFunctionPrototypes
Widget ,XtPointer ,XtPointer 
#endif
);
#line 404 "FoldTree.w"
static void create_line_gc(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 419 "FoldTree.w"
static void redraw_lines(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 439 "FoldTree.w"
static void data_to_icon(
#if NeedFunctionPrototypes
Display *,char * data[],Icon *
#endif
);
#line 462 "FoldTree.w"
static void create_icons(
#if NeedFunctionPrototypes
Display *
#endif
);
#line 375 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 375 "FoldTree.w"
static void expand_CB(Widget  w,XtPointer  client_data,XtPointer  call_data)
#else
#line 375 "FoldTree.w"
static void expand_CB(w,client_data,call_data)Widget  w;XtPointer  client_data;XtPointer  call_data;
#endif
#line 376 "FoldTree.w"
{
	Widget self = (Widget) client_data;

	XtCallCallbackList(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.activate, True);
	XtVaSetValues(self, XtNexpanded, True, NULL);
	((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfFoldingTree_class.layout(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.shrinkToFit);
}
#line 384 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 384 "FoldTree.w"
static void collapse_CB(Widget  w,XtPointer  client_data,XtPointer  call_data)
#else
#line 384 "FoldTree.w"
static void collapse_CB(w,client_data,call_data)Widget  w;XtPointer  client_data;XtPointer  call_data;
#endif
#line 385 "FoldTree.w"
{
	Widget self = (Widget) client_data;

	XtCallCallbackList(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.activate, False);
	XtVaSetValues(self, XtNexpanded, False, NULL);
	((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfFoldingTree_class.layout(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.shrinkToFit);
}
#line 393 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 393 "FoldTree.w"
static void toggle_CB(Widget  w,XtPointer  client_data,XtPointer  call_data)
#else
#line 393 "FoldTree.w"
static void toggle_CB(w,client_data,call_data)Widget  w;XtPointer  client_data;XtPointer  call_data;
#endif
#line 394 "FoldTree.w"
{
	Widget self = (Widget) client_data;

	XtCallCallbackList(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.activate, !((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded);
	XtVaSetValues(self, XtNexpanded, !((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded, NULL);
	((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfFoldingTree_class.layout(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.shrinkToFit);
}
#line 404 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 404 "FoldTree.w"
static void create_line_gc(Widget self)
#else
#line 404 "FoldTree.w"
static void create_line_gc(self)Widget self;
#endif
#line 405 "FoldTree.w"
{
	XtGCMask	mask = 0;
	XGCValues	values;

	if (((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.line_gc != NULL) XtReleaseGC(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.line_gc);
	values.line_width = ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.lineWidth;
	mask |= GCLineWidth;
	values.foreground = ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.lineColor;
	mask |= GCForeground;
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.line_gc = XtGetGC(self, mask, &values);
}
#line 419 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 419 "FoldTree.w"
static void redraw_lines(Widget self)
#else
#line 419 "FoldTree.w"
static void redraw_lines(self)Widget self;
#endif
#line 420 "FoldTree.w"
{
	Widget		child;
	int		i;
	Window		w = XtWindow(self);

	if (!XtIsRealized(self) || !((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded || !((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos || !((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos) return;

	for (i = 2; i < ((XfwfFoldingTreeWidget)self)->composite.num_children; ++i) {
		child = ((XfwfFoldingTreeWidget)self)->composite.children[i];
		if (!XtIsManaged(child)) continue;
		XDrawLine(XtDisplay(self), w, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.line_gc,
			((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[0], ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos[i], ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[1], ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos[i]);
	}
	XDrawLine(XtDisplay(self), w, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.line_gc,
		((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[0], ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos[0], ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[0], ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos[i - 1]);
}
#line 439 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 439 "FoldTree.w"
static void data_to_icon(Display * display,char * data[],Icon * icon)
#else
#line 439 "FoldTree.w"
static void data_to_icon(display,data,icon)Display * display;char * data[];Icon * icon;
#endif
#line 440 "FoldTree.w"
{
	int		 status;

	icon->attributes.valuemask = XpmSize;
	status = XpmCreatePixmapFromData(
		display, DefaultRootWindow(display), data,
		&icon->pixmap, &icon->mask,
		&icon->attributes);
	switch (status) {
		case XpmNoMemory:
			XtError("Out of memory");
		case XpmColorFailed:
			XtError("Failed to allocate color for pixmap");
		case XpmColorError:
			XtWarning("Not all pixmap colors found");
		default: ; /* skip */
	}

}
#line 462 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 462 "FoldTree.w"
static void create_icons(Display * display)
#else
#line 462 "FoldTree.w"
static void create_icons(display)Display * display;
#endif
#line 463 "FoldTree.w"
{
	data_to_icon(display, plus, &iconPlus);
	data_to_icon(display, minus, &iconMinus);
	data_to_icon(display, dot, &iconDot);
}

static XtResource resources[] = {
#line 18 "FoldTree.w"
{XtNexpanded,XtCExpanded,XtRBoolean,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.expanded),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.expanded),XtRImmediate,(XtPointer)False },
#line 22 "FoldTree.w"
{XtNiconExpand,XtCIconExpand,XtRIcon,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.iconExpand),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.iconExpand),XtRImmediate,(XtPointer)NULL },
#line 23 "FoldTree.w"
{XtNiconCollapse,XtCIconCollapse,XtRIcon,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.iconCollapse),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.iconCollapse),XtRImmediate,(XtPointer)NULL },
#line 24 "FoldTree.w"
{XtNiconNoExpand,XtCIconNoExpand,XtRIcon,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.iconNoExpand),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.iconNoExpand),XtRImmediate,(XtPointer)NULL },
#line 28 "FoldTree.w"
{XtNshrinkToFit,XtCShrinkToFit,XtRBoolean,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.shrinkToFit),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.shrinkToFit),XtRImmediate,(XtPointer)True },
#line 32 "FoldTree.w"
{XtNlineWidth,XtCLineWidth,XtRDimension,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.lineWidth),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.lineWidth),XtRImmediate,(XtPointer)2 },
#line 36 "FoldTree.w"
{XtNlineColor,XtCLineColor,XtRPixel,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.lineColor),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.lineColor),XtRString,(XtPointer)"#000"},
#line 40 "FoldTree.w"
{XtNchildSpace,XtCChildSpace,XtRDimension,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.childSpace),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.childSpace),XtRImmediate,(XtPointer)4 },
#line 44 "FoldTree.w"
{XtNframeWidth,XtCFrameWidth,XtRDimension,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFrame.frameWidth),XtOffsetOf(XfwfFoldingTreeRec,xfwfFrame.frameWidth),XtRImmediate,(XtPointer)0 },
#line 46 "FoldTree.w"
{XtNactivate,XtCActivate,XtRCallback,sizeof(((XfwfFoldingTreeRec*)NULL)->xfwfFoldingTree.activate),XtOffsetOf(XfwfFoldingTreeRec,xfwfFoldingTree.activate),XtRImmediate,(XtPointer)NULL },
};

XfwfFoldingTreeClassRec xfwfFoldingTreeClassRec = {
{ /* core_class part */
/* superclass   	*/  (WidgetClass) &xfwfBoardClassRec,
/* class_name   	*/  "XfwfFoldingTree",
/* widget_size  	*/  sizeof(XfwfFoldingTreeRec),
/* class_initialize 	*/  class_initialize,
/* class_part_initialize*/  _resolve_inheritance,
/* class_inited 	*/  FALSE,
/* initialize   	*/  initialize,
/* initialize_hook 	*/  NULL,
/* realize      	*/  XtInheritRealize,
/* actions      	*/  actionsList,
/* num_actions  	*/  3,
/* resources    	*/  resources,
/* num_resources 	*/  10,
/* xrm_class    	*/  NULLQUARK,
/* compres_motion 	*/  True ,
/* compress_exposure 	*/  XtExposeCompressMultiple ,
/* compress_enterleave 	*/  True ,
/* visible_interest 	*/  TRUE ,
/* destroy      	*/  destroy,
/* resize       	*/  resize,
/* expose       	*/  expose,
/* set_values   	*/  set_values,
/* set_values_hook 	*/  NULL,
/* set_values_almost 	*/  XtInheritSetValuesAlmost,
/* get_values+hook 	*/  NULL,
/* accept_focus 	*/  XtInheritAcceptFocus,
/* version      	*/  XtVersion,
/* callback_private 	*/  NULL,
/* tm_table      	*/  defaultTranslations,
/* query_geometry 	*/  XtInheritQueryGeometry,
/* display_acceleator 	*/  XtInheritDisplayAccelerator,
/* extension    	*/  NULL 
},
{ /* composite_class part */
geometry_manager,
change_managed,
insert_child,
XtInheritDeleteChild,
NULL
},
{ /* XfwfCommon_class part */
XtInherit_compute_inside,
XtInherit_total_frame_width,
XtInherit_highlight_border,
XtInherit_unhighlight_border,
XtInherit_would_accept_focus,
XtInherit_traverse,
XtInherit_lighter_color,
XtInherit_darker_color,
/* traversal_trans */  NULL ,
},
{ /* XfwfFrame_class part */
 /* dummy */  0
},
{ /* XfwfBoard_class part */
XtInherit_set_abs_location,
},
{ /* XfwfFoldingTree_class part */
layout,
},
};
WidgetClass xfwfFoldingTreeWidgetClass = (WidgetClass) &xfwfFoldingTreeClassRec;
/*ARGSUSED*/
#line 349 "FoldTree.w"
static void expand(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	expand_CB(self, self, NULL);
}

/*ARGSUSED*/
#line 354 "FoldTree.w"
static void collapse(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	collapse_CB(self, self, NULL);
}

/*ARGSUSED*/
#line 359 "FoldTree.w"
static void toggle(self,event,params,num_params)Widget self;XEvent*event;String*params;Cardinal*num_params;
{
	toggle_CB(self, self, NULL);
}

static void _resolve_inheritance(class)
WidgetClass class;
{
  XfwfFoldingTreeWidgetClass c = (XfwfFoldingTreeWidgetClass) class;
  XfwfFoldingTreeWidgetClass super;
  static CompositeClassExtensionRec extension_rec = {
    NULL, NULLQUARK, XtCompositeExtensionVersion,
    sizeof(CompositeClassExtensionRec), True};
  CompositeClassExtensionRec *ext;
  ext = (XtPointer)XtMalloc(sizeof(*ext));
  *ext = extension_rec;
  ext->next_extension = c->composite_class.extension;
  c->composite_class.extension = ext;
  if (class == xfwfFoldingTreeWidgetClass) return;
  super = (XfwfFoldingTreeWidgetClass)class->core_class.superclass;
  if (c->xfwfFoldingTree_class.layout == XtInherit_layout)
    c->xfwfFoldingTree_class.layout = super->xfwfFoldingTree_class.layout;
}
#line 69 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 69 "FoldTree.w"
static void class_initialize(void)
#else
#line 69 "FoldTree.w"
static void class_initialize()
#endif
#line 70 "FoldTree.w"
{
	static XtConvertArgRec args[] = {
		{ XtWidgetBaseOffset, 0, sizeof(Widget) }
	};

	XtSetTypeConverter(XtRString, "Icon", cvtStringToIcon,
		args, XtNumber(args), XtCacheNone, NULL);
}
#line 83 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 83 "FoldTree.w"
static void initialize(Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 83 "FoldTree.w"
static void initialize(request,self,args,num_args)Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 84 "FoldTree.w"
{
	static char	trans[] = "<Btn1Down>,<Btn1Up>: activate()";

	/* Create default icons if neccesary */
	if (!icons_created) {
		create_icons(XtDisplay(self));
		icons_created = True;
	}

	/* Create a GC */
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.line_gc = NULL;
	create_line_gc(self);

	/* Allocate a couple of arrays for point storage */
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos = (Position *)XtMalloc(2 * sizeof(Position));
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos = (Position *)XtMalloc(2 * sizeof(Position));

	/* Copy over pointers to the default icons */
	if (!((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconExpand) ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconExpand = &iconPlus;
	if (!((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconCollapse) ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconCollapse = &iconMinus;
	if (!((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconNoExpand) ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconNoExpand = &iconDot;

	/* Create the control widget */
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.tree_icon = XtVaCreateManagedWidget(
		"_icon", xfwfIconWidgetClass, self,
		XtNframeWidth, (XtArgVal)2,
		XtVaTypedArg, XtNtranslations,
			XtRString, trans, strlen(trans)+1,
		NULL);

	/* Add the control widget's callback */
	XtAddCallback(((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.tree_icon, XtNactivate, toggle_CB, self);
}
#line 120 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 120 "FoldTree.w"
static void destroy(Widget self)
#else
#line 120 "FoldTree.w"
static void destroy(self)Widget self;
#endif
#line 121 "FoldTree.w"
{
	XtReleaseGC(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.line_gc);
	XtFree((String)((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos);
	XtFree((String)((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos);
}
#line 130 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 174 "FoldTree.w"
static void insert_child(Widget  child)
#else
#line 174 "FoldTree.w"
static void insert_child(child)Widget  child;
#endif
{ Widget self = XtParent(child); {
	xfwfBoardClassRec.composite_class.insert_child(child);
	if (((XfwfFoldingTreeWidget)self)->composite.num_children > 2) {
		((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos = (Position*)XtRealloc((void*)((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos,
			((XfwfFoldingTreeWidget)self)->composite.num_children * sizeof(Position));
	}
}
}
#line 142 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 142 "FoldTree.w"
static void change_managed(Widget self)
#else
#line 142 "FoldTree.w"
static void change_managed(self)Widget self;
#endif
#line 143 "FoldTree.w"
{
	((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfFoldingTree_class.layout(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.shrinkToFit);
}
#line 149 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 149 "FoldTree.w"
static void resize(Widget self)
#else
#line 149 "FoldTree.w"
static void resize(self)Widget self;
#endif
#line 150 "FoldTree.w"
{
	((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfFoldingTree_class.layout(self, False);
}
#line 157 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 157 "FoldTree.w"
static Boolean  set_values(Widget  old,Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 157 "FoldTree.w"
static Boolean  set_values(old,request,self,args,num_args)Widget  old;Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 158 "FoldTree.w"
{
	Boolean redraw = False;
	Boolean dolayout = False;

	/* Recreate the line_gc if the width or color needs changing */
	if (((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.lineWidth != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.lineWidth ||
	    ((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.lineColor != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.lineColor) {
		create_line_gc(self);
		redraw = True;
	}

	/* Check whether any of the icons have changed */
	if (((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.iconExpand != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconExpand ||
	    ((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.iconCollapse != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconCollapse ||
	    ((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.iconNoExpand != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconNoExpand) {
		dolayout = True;
		redraw = True;
	}

	/* Check whether any of the layout parameters have changed */
	if (((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.expanded != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded ||
	    ((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.shrinkToFit != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.shrinkToFit ||
	    ((XfwfFoldingTreeWidget)old)->xfwfFoldingTree.childSpace != ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.childSpace) {
		dolayout = True;
		redraw = True;
	}

	if (dolayout) {
		((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfFoldingTree_class.layout(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.shrinkToFit);
	}

	return redraw;
}
#line 194 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 167 "FoldTree.w"
static XtGeometryResult  geometry_manager(Widget  child,XtWidgetGeometry * request,XtWidgetGeometry * reply)
#else
#line 167 "FoldTree.w"
static XtGeometryResult  geometry_manager(child,request,reply)Widget  child;XtWidgetGeometry * request;XtWidgetGeometry * reply;
#endif
{ Widget self = XtParent(child); {
	Dimension	nw, nh, nb;

	if (request->request_mode & (CWX | CWY)) return XtGeometryNo;
	if (request->request_mode & XtCWQueryOnly) return XtGeometryYes;

	nw = request->request_mode & CWWidth ? request->width : ((XfwfFoldingTreeWidget)child)->core.width;
	nh = request->request_mode & CWHeight ? request->height : ((XfwfFoldingTreeWidget)child)->core.height;
	nb = request->request_mode & CWBorderWidth ?
		request->border_width : ((XfwfFoldingTreeWidget)child)->core.border_width;

	if (nw == ((XfwfFoldingTreeWidget)child)->core.width &&
            nh == ((XfwfFoldingTreeWidget)child)->core.height &&
	    nb == ((XfwfFoldingTreeWidget)child)->core.border_width) return XtGeometryNo;

	XtResizeWidget(child, nw, nh, nb);
	((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfFoldingTree_class.layout(self, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.shrinkToFit);
	return XtGeometryDone;
}
}
#line 219 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 219 "FoldTree.w"
static void layout(Widget self,int  shrink)
#else
#line 219 "FoldTree.w"
static void layout(self,shrink)Widget self;int  shrink;
#endif
#line 220 "FoldTree.w"
{
	Widget		icon = ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.tree_icon, child;
	Boolean		can_expand;
	Position	left, top;
	Dimension	width, height;
	Dimension	max_width = 0;	/* Largest child widget width */
	Position	y;		/* Current top of next widget */
	Dimension	dy;		/* Increment to next widget's position*/
	int		i;

	/* Find out what sort of icon should be in use */
	can_expand = (((XfwfFoldingTreeWidget)self)->composite.num_children > 2);
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded &= can_expand;
	if (can_expand) {
		if (((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded) {
			XtVaSetValues(icon, XtNimage, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconCollapse,
				NULL);
		} else {
			XtVaSetValues(icon, XtNimage, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconExpand,
				NULL);
		}
	} else {
		XtVaSetValues(icon, XtNimage, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.iconNoExpand, NULL);
	}

	/* Find the widgets dimensions */
	((XfwfFoldingTreeWidgetClass)self->core.widget_class)->xfwfCommon_class.compute_inside(self, &left, &top, &width, &height);

	/* xpos[0] = middle of the icon */
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[0] = left + ((XfwfFoldingTreeWidget)icon)->core.border_width + ((XfwfFoldingTreeWidget)icon)->core.width / 2;

	/* ypos[0] = bottom of the icon */
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos[0] = top + 2 * ((XfwfFoldingTreeWidget)icon)->core.border_width + ((XfwfFoldingTreeWidget)icon)->core.height;
	
	/* xpos[1] = new left hand side of child icons */
	((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[1] = left + 2 * ((XfwfFoldingTreeWidget)icon)->core.border_width +
			((XfwfFoldingTreeWidget)icon)->core.width + ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.childSpace;

	/* Current widget position is the top of the window */
	y = top;

	/* Loop over all children except the first (the control widget) */
	for (i = 1; i < ((XfwfFoldingTreeWidget)self)->composite.num_children; ++i) {
		child = ((XfwfFoldingTreeWidget)self)->composite.children[i];
		if (!XtIsManaged(child)) continue;

		/* Calculate first component if position step */
		dy = ((XfwfFoldingTreeWidget)child)->core.height + 2 * ((XfwfFoldingTreeWidget)child)->core.border_width;

		/* Check whether the control icon is taller than the
		   label widget */
		if (i == 1) {
			dy = max(dy, ((XfwfFoldingTreeWidget)icon)->core.height + 
					2 * ((XfwfFoldingTreeWidget)icon)->core.border_width);
			max_width = ((XfwfFoldingTreeWidget)child)->core.width + 2 * ((XfwfFoldingTreeWidget)child)->core.border_width;
		}

		/* Set visual stage of child widgets (unless it's the
		   label widget */
		if (i > 1) {
			XtSetMappedWhenManaged(child, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded);
		}

		/* Move the widget to it's place */
		XtMoveWidget(child, ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[1], y);

		/* Calculate position of tree line into this child widget
		   NB: If the child widget is itself a subtree then the
		   tree line points at the midpoint of the subtree's control
		   widget instead of the midpoint of the entire widget */

		if (XtIsSubclass(child, xfwfFoldingTreeWidgetClass)) {
			XfwfFoldingTreeWidget tmp =
				(XfwfFoldingTreeWidget)child;
			XfwfIconWidget icon =
				(XfwfIconWidget)((XfwfFoldingTreeWidget)tmp)->xfwfFoldingTree.tree_icon;
			((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos[i] = y + ((XfwfFoldingTreeWidget)child)->core.border_width +
				((XfwfFoldingTreeWidget)icon)->core.height / 2;
		} else {
			((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.ypos[i] = y + ((XfwfFoldingTreeWidget)child)->core.border_width + ((XfwfFoldingTreeWidget)child)->core.height / 2;
		}

		/* Calculate the position of the next widget if the current
		   widget is visible */
		if (i == 1 || ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.expanded) {
			y += dy + ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.childSpace;
			max_width = max(max_width,
				((XfwfFoldingTreeWidget)child)->core.width + 2 * ((XfwfFoldingTreeWidget)child)->core.border_width);
		}

	}

	/* Clear the old lines if neccesary */
	if (XtIsRealized(self)) XClearWindow(XtDisplay(self), XtWindow(self));

	/* Redraw the tree lines */
	redraw_lines(self);

	/* Shrink this widget if neccesary */
	if (shrink) {
		width = ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.xpos[1] + max_width;
		height = y - ((XfwfFoldingTreeWidget)self)->xfwfFoldingTree.childSpace;
		if (width != ((XfwfFoldingTreeWidget)self)->core.width ||
		    height != ((XfwfFoldingTreeWidget)self)->core.height) {
			XtVaSetValues(self,
				XtNwidth, width,
				XtNheight, height,
				NULL);
		}
	}
}
#line 334 "FoldTree.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 334 "FoldTree.w"
static void expose(Widget self,XEvent * event,Region  region)
#else
#line 334 "FoldTree.w"
static void expose(self,event,region)Widget self;XEvent * event;Region  region;
#endif
#line 335 "FoldTree.w"
{
	xfwfBoardClassRec.core_class.expose(self, event, region);
	if (XtIsRealized(self)) {
		redraw_lines(self);
	}
}

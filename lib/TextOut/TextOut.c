/* Generated by wbuild from "TextOut.w"
** (generator version $Revision$ of $Date$)
*/
#if HAVE_CONFIG_H
#  include <config.h>
#endif

#include <X11/IntrinsicP.h>
#include <X11/StringDefs.h>
#line 407 "TextOut.w"
#include <assert.h>
#line 408 "TextOut.w"
#include <ctype.h>
#line 409 "TextOut.w"
#include <stdio.h>
#line 410 "TextOut.w"
#include <string.h>
#include <Xfwf/TextOutP.h>
static void _resolve_inheritance(
#if NeedFunctionPrototypes
WidgetClass
#endif
);
#line 191 "TextOut.w"
static void initialize(
#if NeedFunctionPrototypes
Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 205 "TextOut.w"
static void destroy(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 226 "TextOut.w"
static Boolean  set_values(
#if NeedFunctionPrototypes
Widget ,Widget ,Widget,ArgList ,Cardinal *
#endif
);
#line 260 "TextOut.w"
static void expose(
#if NeedFunctionPrototypes
Widget,XEvent *,Region 
#endif
);
#line 68 "TextOut.w"
static void make_gc(
#if NeedFunctionPrototypes
Widget
#endif
);
#line 88 "TextOut.w"
static void compute_line_height(
#if NeedFunctionPrototypes
Widget,TextChunk *,int *,int *
#endif
);
#line 112 "TextOut.w"
static void draw_string(
#if NeedFunctionPrototypes
Widget,XFontStruct *,int ,char *,int ,int ,int 
#endif
);
#line 141 "TextOut.w"
static void compute_size(
#if NeedFunctionPrototypes
Widget,Dimension *,Dimension *
#endif
);
#line 68 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 68 "TextOut.w"
static void make_gc(Widget self)
#else
#line 68 "TextOut.w"
static void make_gc(self)Widget self;
#endif
#line 69 "TextOut.w"
{
	XtGCMask mask, dynmask, dontcaremask;
	XGCValues values;

	values.foreground=((XfwfTextOutWidget)self)->xfwfTextOut.color1;
	values.background=((XfwfTextOutWidget)self)->core.background_pixel;
	values.font=((XfwfTextOutWidget)self)->xfwfTextOut.font1->fid;
	dynmask = GCForeground | GCBackground | GCFont;
	dontcaremask = GCJoinStyle | GCFillRule | GCTile
		| GCTileStipXOrigin | GCTileStipYOrigin | GCDashOffset | GCDashList
		| GCStipple | GCGraphicsExposures | GCArcMode | GCLineWidth | GCClipMask;
	mask=0;
	((XfwfTextOutWidget)self)->xfwfTextOut.ngc=XtAllocateGC(self,((XfwfTextOutWidget)self)->core.depth,mask,&values,dynmask,dontcaremask);
}
#line 88 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 88 "TextOut.w"
static void compute_line_height(Widget self,TextChunk * chunk,int * ma,int * md)
#else
#line 88 "TextOut.w"
static void compute_line_height(self,chunk,ma,md)Widget self;TextChunk * chunk;int * ma;int * md;
#endif
#line 89 "TextOut.w"
{
	XFontStruct *f;

	*ma=0, *md=0;
	if(chunk==NULL) return;
	do {
		switch(chunk->font)
		{
			case 2:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font2;	break;
			case 3:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font3;	break;
			case 4:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font4;	break;
			default:	f=((XfwfTextOutWidget)self)->xfwfTextOut.font1;	break;
		}

		*ma = *ma>f->ascent ? *ma : f->ascent;
		*md = *md>f->descent ? *md : f->descent;
		chunk = chunk->next;
	} while(chunk && !chunk->nl);
}
#line 112 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 112 "TextOut.w"
static void draw_string(Widget self,XFontStruct * f,int  c,char * s,int  l,int  x,int  y)
#else
#line 112 "TextOut.w"
static void draw_string(self,f,c,s,l,x,y)Widget self;XFontStruct * f;int  c;char * s;int  l;int  x;int  y;
#endif
#line 113 "TextOut.w"
{
	XSetFont(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, f->fid);
	switch(c)
	{
		case 2:	XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color2);
			break;
		case 3:	XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color3);
			break;
		case 4:	XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color4);
			break;
		case 5:	XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color5);
			break;
		case 6:	XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color6);
			break;
		case 7:	XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color7);
			break;
		case 8:	XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color8);
			break;
		default:XSetForeground(XtDisplay(self), ((XfwfTextOutWidget)self)->xfwfTextOut.ngc, ((XfwfTextOutWidget)self)->xfwfTextOut.color1);
			break;
	}
			
	XDrawString(XtDisplay(self),XtWindow(self),((XfwfTextOutWidget)self)->xfwfTextOut.ngc,
			x+((XfwfTextOutWidget)self)->xfwfTextOut.internalOffset,y,s,l);
}
#line 141 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 141 "TextOut.w"
static void compute_size(Widget self,Dimension * wd,Dimension * ht)
#else
#line 141 "TextOut.w"
static void compute_size(self,wd,ht)Widget self;Dimension * wd;Dimension * ht;
#endif
#line 142 "TextOut.w"
{
	TextChunk *chunk;
	int w=0;
	int maxw=0;
	int ma, md;
	XFontStruct *f;
	char *s, *e;
	
	compute_line_height(self, ((XfwfTextOutWidget)self)->xfwfTextOut.text, &ma, &md);
	*ht = (((XfwfTextOutWidget)self)->xfwfTextOut.internalOffset)*2 + ma + md;
		
	for(chunk=((XfwfTextOutWidget)self)->xfwfTextOut.text ; chunk ; chunk=chunk->next)
	{
		switch(chunk->font)
		{
			case 2:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font2;	break;
			case 3:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font3;	break;
			case 4:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font4;	break;
			default:	f=((XfwfTextOutWidget)self)->xfwfTextOut.font1;	break;
		}

		s=chunk->text;
		e=strchr(s, '\t');
		while(e!=NULL)
		{
			if(e-s!=0) w+=XTextWidth(f,s,e-s);
			w+=(40-w%40)==0 ? 40 : (40-w%40);
			s=e+1;
			e=strchr(s, '\t');
		}
		w+=XTextWidth(f,s,strlen(s));

		if(chunk->nl)
		{
			maxw = maxw>w ? maxw : w;
			w=0;
			compute_line_height(self, chunk->next, &ma, &md);
			*ht += ma + md;
		}
	}
	maxw = maxw>w ? maxw : w;
	*wd=maxw + (((XfwfTextOutWidget)self)->xfwfTextOut.internalOffset)*2;
}

static XtResource resources[] = {
#line 14 "TextOut.w"
{XtNinternalOffset,XtCInternalOffset,XtRDimension,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.internalOffset),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.internalOffset),XtRImmediate,(XtPointer)2 },
#line 18 "TextOut.w"
{XtNfont1,XtCFont1,XtRFontStruct,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.font1),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.font1),XtRString,(XtPointer)XtDefaultFont },
#line 19 "TextOut.w"
{XtNfont2,XtCFont2,XtRFontStruct,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.font2),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.font2),XtRString,(XtPointer)XtDefaultFont },
#line 20 "TextOut.w"
{XtNfont3,XtCFont3,XtRFontStruct,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.font3),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.font3),XtRString,(XtPointer)XtDefaultFont },
#line 21 "TextOut.w"
{XtNfont4,XtCFont4,XtRFontStruct,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.font4),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.font4),XtRString,(XtPointer)XtDefaultFont },
#line 25 "TextOut.w"
{XtNcolor1,XtCColor1,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color1),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color1),XtRString,(XtPointer)XtDefaultForeground },
#line 26 "TextOut.w"
{XtNcolor2,XtCColor2,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color2),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color2),XtRString,(XtPointer)XtDefaultForeground },
#line 27 "TextOut.w"
{XtNcolor3,XtCColor3,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color3),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color3),XtRString,(XtPointer)XtDefaultForeground },
#line 28 "TextOut.w"
{XtNcolor4,XtCColor4,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color4),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color4),XtRString,(XtPointer)XtDefaultForeground },
#line 29 "TextOut.w"
{XtNcolor5,XtCColor5,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color5),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color5),XtRString,(XtPointer)XtDefaultForeground },
#line 30 "TextOut.w"
{XtNcolor6,XtCColor6,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color6),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color6),XtRString,(XtPointer)XtDefaultForeground },
#line 31 "TextOut.w"
{XtNcolor7,XtCColor7,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color7),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color7),XtRString,(XtPointer)XtDefaultForeground },
#line 32 "TextOut.w"
{XtNcolor8,XtCColor8,XtRPixel,sizeof(((XfwfTextOutRec*)NULL)->xfwfTextOut.color8),XtOffsetOf(XfwfTextOutRec,xfwfTextOut.color8),XtRString,(XtPointer)XtDefaultForeground },
};

XfwfTextOutClassRec xfwfTextOutClassRec = {
{ /* core_class part */
/* superclass   	*/  (WidgetClass) &xfwfCommonClassRec,
/* class_name   	*/  "XfwfTextOut",
/* widget_size  	*/  sizeof(XfwfTextOutRec),
/* class_initialize 	*/  NULL,
/* class_part_initialize*/  _resolve_inheritance,
/* class_inited 	*/  FALSE,
/* initialize   	*/  initialize,
/* initialize_hook 	*/  NULL,
/* realize      	*/  XtInheritRealize,
/* actions      	*/  NULL,
/* num_actions  	*/  0,
/* resources    	*/  resources,
/* num_resources 	*/  13,
/* xrm_class    	*/  NULLQUARK,
/* compres_motion 	*/  True ,
/* compress_exposure 	*/  XtExposeCompressMultiple |XtExposeGraphicsExposeMerged ,
/* compress_enterleave 	*/  True ,
/* visible_interest 	*/  TRUE ,
/* destroy      	*/  destroy,
/* resize       	*/  XtInheritResize,
/* expose       	*/  expose,
/* set_values   	*/  set_values,
/* set_values_hook 	*/  NULL,
/* set_values_almost 	*/  XtInheritSetValuesAlmost,
/* get_values+hook 	*/  NULL,
/* accept_focus 	*/  XtInheritAcceptFocus,
/* version      	*/  XtVersion,
/* callback_private 	*/  NULL,
/* tm_table      	*/  NULL,
/* query_geometry 	*/  XtInheritQueryGeometry,
/* display_acceleator 	*/  XtInheritDisplayAccelerator,
/* extension    	*/  NULL 
},
{ /* composite_class part */
XtInheritGeometryManager,
XtInheritChangeManaged,
XtInheritInsertChild,
XtInheritDeleteChild,
NULL
},
{ /* XfwfCommon_class part */
XtInherit_compute_inside,
XtInherit_total_frame_width,
XtInherit_highlight_border,
XtInherit_unhighlight_border,
XtInherit_would_accept_focus,
XtInherit_traverse,
XtInherit_lighter_color,
XtInherit_darker_color,
/* traversal_trans */  NULL ,
},
{ /* XfwfTextOut_class part */
 /* dummy */  0
},
};
WidgetClass xfwfTextOutWidgetClass = (WidgetClass) &xfwfTextOutClassRec;
static void _resolve_inheritance(class)
WidgetClass class;
{
  XfwfTextOutWidgetClass c = (XfwfTextOutWidgetClass) class;
  XfwfTextOutWidgetClass super;
  static CompositeClassExtensionRec extension_rec = {
    NULL, NULLQUARK, XtCompositeExtensionVersion,
    sizeof(CompositeClassExtensionRec), True};
  CompositeClassExtensionRec *ext;
  ext = (XtPointer)XtMalloc(sizeof(*ext));
  *ext = extension_rec;
  ext->next_extension = c->composite_class.extension;
  c->composite_class.extension = ext;
  if (class == xfwfTextOutWidgetClass) return;
  super = (XfwfTextOutWidgetClass)class->core_class.superclass;
}
#line 191 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 191 "TextOut.w"
static void initialize(Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 191 "TextOut.w"
static void initialize(request,self,args,num_args)Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 192 "TextOut.w"
{
	((XfwfTextOutWidget)self)->xfwfTextOut.text=NULL;
	((XfwfTextOutWidget)self)->xfwfTextOut.tail=NULL;

	((XfwfTextOutWidget)self)->xfwfTextOut.ngc=NULL;
	make_gc(self);
	
	((XfwfTextOutWidget)self)->xfwfCommon.highlightThickness=0;
	((XfwfTextOutWidget)self)->core.width=1;
	((XfwfTextOutWidget)self)->core.height=1;
}
#line 205 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 205 "TextOut.w"
static void destroy(Widget self)
#else
#line 205 "TextOut.w"
static void destroy(self)Widget self;
#endif
#line 206 "TextOut.w"
{
	TextChunk *n, *c;
	
	XtReleaseGC(self, ((XfwfTextOutWidget)self)->xfwfTextOut.ngc);

	c=((XfwfTextOutWidget)self)->xfwfTextOut.text;
	while(c)
	{
		n=c->next;
		XtFree((char *)c->text);
		XtFree((char *)c);
		c=n;
	}
	((XfwfTextOutWidget)self)->xfwfTextOut.text=NULL;
	((XfwfTextOutWidget)self)->xfwfTextOut.tail=NULL;
}
#line 226 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 226 "TextOut.w"
static Boolean  set_values(Widget  old,Widget  request,Widget self,ArgList  args,Cardinal * num_args)
#else
#line 226 "TextOut.w"
static Boolean  set_values(old,request,self,args,num_args)Widget  old;Widget  request;Widget self;ArgList  args;Cardinal * num_args;
#endif
#line 227 "TextOut.w"
{
	int do_size = False;

	((XfwfTextOutWidget)self)->xfwfCommon.highlightThickness=0;

	if(((XfwfTextOutWidget)old)->xfwfTextOut.internalOffset != ((XfwfTextOutWidget)self)->xfwfTextOut.internalOffset)
		do_size = True;

	if(((XfwfTextOutWidget)old)->xfwfTextOut.font1 != ((XfwfTextOutWidget)self)->xfwfTextOut.font1)
		do_size = True;
		
	if(((XfwfTextOutWidget)old)->xfwfTextOut.font2 != ((XfwfTextOutWidget)self)->xfwfTextOut.font2)
		do_size = True;
		
	if(((XfwfTextOutWidget)old)->xfwfTextOut.font3 != ((XfwfTextOutWidget)self)->xfwfTextOut.font3)
		do_size = True;
		
	if(((XfwfTextOutWidget)old)->xfwfTextOut.font4 != ((XfwfTextOutWidget)self)->xfwfTextOut.font4)
		do_size = True;
		
	if(do_size)
		compute_size(self, &(((XfwfTextOutWidget)self)->core.width), &(((XfwfTextOutWidget)self)->core.height));

	return do_size;
}
#line 260 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 260 "TextOut.w"
static void expose(Widget self,XEvent * event,Region  region)
#else
#line 260 "TextOut.w"
static void expose(self,event,region)Widget self;XEvent * event;Region  region;
#endif
#line 261 "TextOut.w"
{
	TextChunk *chunk;
	int pos, w, cw;
	int ma, md;
	XFontStruct *f;
	char *s, *e;
		
	if(! XtIsRealized(self))
		return ;

	if(event == NULL)
	{
		XClearWindow(XtDisplay(self),XtWindow(self));
		xfwfCommonClassRec.core_class.expose(self,event,region);
		return;
	}

	xfwfCommonClassRec.core_class.expose(self,event,region);

	compute_line_height(self, ((XfwfTextOutWidget)self)->xfwfTextOut.text, &ma, &md);
	pos=ma + ((XfwfTextOutWidget)self)->xfwfTextOut.internalOffset;
	w=0;
	
	for(chunk=((XfwfTextOutWidget)self)->xfwfTextOut.text ; chunk ; chunk=chunk->next)
	{
		if(pos+md>=event->xexpose.y) break;
		if(chunk->nl)
		{
			pos+=md;
			compute_line_height(self, chunk, &ma, &md);
			pos+=ma;
		}
	}
	
	for( ; chunk && (pos-ma)<(event->xexpose.y+event->xexpose.height); chunk=chunk->next)
	{
		switch(chunk->font)
		{
			case 2:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font2;	break;
			case 3:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font3;	break;
			case 4:		f=((XfwfTextOutWidget)self)->xfwfTextOut.font4;	break;
			default:	f=((XfwfTextOutWidget)self)->xfwfTextOut.font1;	break;
		}

		s=chunk->text;
		e=strchr(s, '\t');
		while(e!=NULL)
		{
			if(e-s!=0) {
				cw=XTextWidth(f,s,e-s);
				if(XRectInRegion(region, w, pos-ma, w+cw, pos+md) != RectangleOut)
					draw_string(self, f, chunk->color, s, e-s, w, pos);
				w+=cw;
			}
			w+=(40-w%40)==0 ? 40 : (40-w%40);
			s=e+1;
			e=strchr(s, '\t');
		}
		cw=XTextWidth(f,s,strlen(s));
		if(XRectInRegion(region, w, pos-ma, w+cw, pos+md) != RectangleOut)
			draw_string(self, f, chunk->color, s, strlen(s), w, pos);
		w+=cw;
		
		if(chunk->nl)
		{
			w=0;
			pos+=md;
			compute_line_height(self, chunk, &ma, &md);
			pos+=ma;
		}
	}

}
#line 346 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 346 "TextOut.w"
void XfwfAddText(Widget self,char * data,int  f,int  c,int  nl)
#else
#line 346 "TextOut.w"
void XfwfAddText(self,data,f,c,nl)Widget self;char * data;int  f;int  c;int  nl;
#endif
#line 347 "TextOut.w"
{
	TextChunk *chunk;
	Dimension w, h;
		
	assert(XtIsSubclass(self, xfwfTextOutWidgetClass));

	if(data==NULL)
	{
		compute_size(self, &w, &h);
		XtMakeResizeRequest(self, w, h, NULL, NULL);
		return;
	}
	
	chunk=(TextChunk*)XtMalloc(sizeof(TextChunk));
	chunk->next=NULL;
	chunk->font=f;
	chunk->color=c;
	chunk->nl=nl;
	chunk->text=XtMalloc(1+strlen(data));
	strcpy(chunk->text,data);

	if(((XfwfTextOutWidget)self)->xfwfTextOut.text==NULL)
		((XfwfTextOutWidget)self)->xfwfTextOut.text=chunk;
	else
		((XfwfTextOutWidget)self)->xfwfTextOut.tail->next=chunk;

	((XfwfTextOutWidget)self)->xfwfTextOut.tail=chunk;
}
#line 381 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 381 "TextOut.w"
void XfwfEraseText(Widget self)
#else
#line 381 "TextOut.w"
void XfwfEraseText(self)Widget self;
#endif
#line 382 "TextOut.w"
{
	TextChunk *n, *c;
	
	c=((XfwfTextOutWidget)self)->xfwfTextOut.text;
	while(c)
	{
		n=c->next;
		XtFree((char *)c->text);
		XtFree((char *)c);
		c=n;
	}
	((XfwfTextOutWidget)self)->xfwfTextOut.text=NULL;
	((XfwfTextOutWidget)self)->xfwfTextOut.tail=NULL;
}
#line 400 "TextOut.w"
/*ARGSUSED*/
#if NeedFunctionPrototypes
#line 400 "TextOut.w"
void XfwfComputeTextOutSize(Widget self,Dimension * w,Dimension * h)
#else
#line 400 "TextOut.w"
void XfwfComputeTextOutSize(self,w,h)Widget self;Dimension * w;Dimension * h;
#endif
#line 401 "TextOut.w"
{
	compute_size(self, w, h);
}
